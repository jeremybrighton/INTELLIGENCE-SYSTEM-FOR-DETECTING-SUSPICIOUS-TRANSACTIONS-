{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"id":"TzAQv3yJiSHs","executionInfo":{"status":"ok","timestamp":1771844723113,"user_tz":-180,"elapsed":2934,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["# Import necessary libraries for data analysis, machine learning, and visualization\n","import pandas as pd\n","import numpy as np\n","import matplotlib.pyplot as plt\n","import matplotlib.cm as cm\n","import matplotlib.patches as mpatches\n","import seaborn as sns\n","from IPython.display import display\n","from sklearn.model_selection import train_test_split\n","from sklearn.preprocessing import StandardScaler, OneHotEncoder\n","from sklearn.compose import ColumnTransformer\n","from sklearn.ensemble import RandomForestClassifier, IsolationForest\n","from sklearn.pipeline import Pipeline\n","from sklearn.metrics import classification_report, confusion_matrix, roc_auc_score\n","from sklearn.metrics import confusion_matrix, precision_score, recall_score, f1_score, roc_auc_score, roc_curve\n","\n","# For reproducibility\n","np.random.seed(42)\n","\n","import joblib\n","from sklearn.metrics import confusion_matrix\n","from scipy.stats import chi2_contingency\n","from sklearn.metrics import roc_auc_score, roc_curve\n","import matplotlib.pyplot as plt\n","from sklearn.model_selection import train_test_split\n","\n","from sklearn.preprocessing import StandardScaler\n","from sklearn.ensemble import IsolationForest\n","\n","import warnings\n","warnings.filterwarnings(\"ignore\")"]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":319},"executionInfo":{"elapsed":121274,"status":"error","timestamp":1771844844402,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"GEEM3CCj48XU","outputId":"3ee80170-244d-451c-a0f8-a138308dd6e4"},"outputs":[{"output_type":"error","ename":"ValueError","evalue":"mount failed","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mValueError\u001b[0m                                Traceback (most recent call last)","\u001b[0;32m/tmp/ipython-input-1408506528.py\u001b[0m in \u001b[0;36m<cell line: 0>\u001b[0;34m()\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[0;32mfrom\u001b[0m \u001b[0mgoogle\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcolab\u001b[0m \u001b[0;32mimport\u001b[0m \u001b[0mdrive\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 2\u001b[0;31m \u001b[0mdrive\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mmount\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'/content/drive'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m","\u001b[0;32m/usr/local/lib/python3.12/dist-packages/google/colab/drive.py\u001b[0m in \u001b[0;36mmount\u001b[0;34m(mountpoint, force_remount, timeout_ms, readonly)\u001b[0m\n\u001b[1;32m     95\u001b[0m \u001b[0;32mdef\u001b[0m \u001b[0mmount\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mmountpoint\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mforce_remount\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mFalse\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mtimeout_ms\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m120000\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mreadonly\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mFalse\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     96\u001b[0m   \u001b[0;34m\"\"\"Mount your Google Drive at the specified mountpoint path.\"\"\"\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 97\u001b[0;31m   return _mount(\n\u001b[0m\u001b[1;32m     98\u001b[0m       \u001b[0mmountpoint\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     99\u001b[0m       \u001b[0mforce_remount\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mforce_remount\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.12/dist-packages/google/colab/drive.py\u001b[0m in \u001b[0;36m_mount\u001b[0;34m(mountpoint, force_remount, timeout_ms, ephemeral, readonly)\u001b[0m\n\u001b[1;32m    270\u001b[0m             \u001b[0;34m'https://research.google.com/colaboratory/faq.html#drive-timeout'\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    271\u001b[0m         )\n\u001b[0;32m--> 272\u001b[0;31m       \u001b[0;32mraise\u001b[0m \u001b[0mValueError\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'mount failed'\u001b[0m \u001b[0;34m+\u001b[0m \u001b[0mextra_reason\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    273\u001b[0m     \u001b[0;32melif\u001b[0m \u001b[0mcase\u001b[0m \u001b[0;34m==\u001b[0m \u001b[0;36m4\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    274\u001b[0m       \u001b[0;31m# Terminate the DriveFS binary before killing bash.\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mValueError\u001b[0m: mount failed"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"markdown","metadata":{"id":"jjCcCuoLn7Wh"},"source":[]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125383,"status":"aborted","timestamp":1771844844398,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"rIowUHi479Vu"},"outputs":[],"source":["!ls /content/drive/MyDrive/"]},{"cell_type":"markdown","metadata":{"id":"i8jV1NtCoGoQ"},"source":["Listed the contents of my Google Drive to confirm that all project files, datasets, and relevant documents are accessible for processing in Colab."]},{"cell_type":"markdown","metadata":{"id":"KRwl8G0boGkx"},"source":[]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125625,"status":"aborted","timestamp":1771844844652,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"jY4x4uEV_lSF"},"outputs":[],"source":["file_path = \"/content/drive/MyDrive/AIML_Dataset_100k.csv\"\n","df = pd.read_csv(file_path)\n","\n","df.head()"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125659,"status":"aborted","timestamp":1771844844691,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"8B9Xvl-iBHil"},"outputs":[],"source":["round((df[\"isFraud\"].value_counts()[1] / df.shape[0]) * 100, 2)"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125650,"status":"aborted","timestamp":1771844844693,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"XczyLHJRDSLD"},"outputs":[],"source":["fraud_by_type = df.groupby(\"type\")[\"isFraud\"].mean().sort_values(ascending=False)\n","fraud_by_type.plot(kind=\"bar\", title=\"Fraud Rate by type\", color=\"brown\")\n","plt.ylabel(\"Fraud Rate\")\n","plt.show()"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125642,"status":"aborted","timestamp":1771844844695,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"jSjNBxXtDX2j"},"outputs":[],"source":["df[\"amount\"].describe().astype(int)"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":2,"status":"aborted","timestamp":1771844844698,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"siKuSjJEGcdp"},"outputs":[],"source":["df.columns"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"xAFAr0nvJK2m","executionInfo":{"status":"aborted","timestamp":1771844844701,"user_tz":-180,"elapsed":4,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["# Calculate balance differences\n","df[\"balanceDiffOrig\"] = df[\"oldbalanceOrg\"] - df[\"newbalanceOrig\"]\n","df[\"balanceDiffDest\"] = df[\"newbalanceDest\"] - df[\"oldbalanceDest\"]"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":9,"status":"aborted","timestamp":1771844844709,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"mnBKda_AKnJ2"},"outputs":[],"source":["(df[\"balanceDiffOrig\"] < 0).sum()"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":10,"status":"aborted","timestamp":1771844844711,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"-HYGpufsKswE"},"outputs":[],"source":["(df[\"balanceDiffDest\"] < 0).sum()"]},{"cell_type":"markdown","metadata":{"id":"YFMvCk48ruWL"},"source":["This mirrors the origin balance check and confirms that the computed balance differences are consistent for both accounts."]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":10,"status":"aborted","timestamp":1771844844713,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"EXSFU_6zLE-H"},"outputs":[],"source":["df.head(2)"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":8,"status":"aborted","timestamp":1771844844714,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"5gj-BK2hLtk7"},"outputs":[],"source":["custom_palette = sns.color_palette(\"YlOrBr\", 3)\n","\n","# Prepare data\n","frauds_per_step = df[df[\"isFraud\"] == 1][\"step\"].value_counts().sort_index()\n","\n","# Plot\n","fig, axes = plt.subplots(1, 1, figsize=(10, 6))\n","\n","axes.plot(\n","    frauds_per_step.index,\n","    frauds_per_step.values,\n","    label=\"Frauds per Step\",\n","    marker='o',\n","    color=custom_palette[2]  # Dark brown\n",")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":9,"status":"aborted","timestamp":1771844844716,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"E5PWxU70OPCY"},"outputs":[],"source":["# Filter for transactions that are either TRANSFER or CASH_OUT\n","fraud_type = df[df[\"type\"].isin([\"TRANSFER\", \"CASH_OUT\"])]\n","fraud_type[\"type\"].value_counts()"]},{"cell_type":"markdown","metadata":{"id":"55d33GPjsWNg"},"source":["This step filters the dataset to include only transactions of type TRANSFER or CASH_OUT, which are often more prone to fraud.\n","\n","fraud_type contains only these selected types.\n","\n","value_counts() shows how many transactions belong to each of these types."]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":9,"status":"aborted","timestamp":1771844844717,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"QwFCgU1WOXCf"},"outputs":[],"source":["custom_palette = sns.color_palette(\"YlOrBr\", 3)\n","\n","fig, axes = plt.subplots(1, 1, figsize=(8, 6))\n","\n","sns.countplot(\n","    data=fraud_type,\n","    x=\"type\",\n","    hue=\"isFraud\",\n","    palette=[custom_palette[2], custom_palette[1]],  # Dark brown for Fraud, lighter brown for Legit\n","    ax=axes\n",")\n","\n","axes.set_title(\"Fraud Distribution in Transfer & Cash_Out\")\n","axes.set_xlabel(\"Transaction Type\")\n","axes.set_ylabel(\"Count\")\n","axes.set_axisbelow(True)\n","axes.grid(axis='y', color='gray', linestyle='--', linewidth=0.7)\n","axes.legend(title=\"Is Fraud\")\n","\n","plt.show()"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":8,"status":"aborted","timestamp":1771844844718,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"qIROfMcjPkqJ"},"outputs":[],"source":["corr = df[[\"amount\",\"oldbalanceOrg\",\"newbalanceOrig\",\"oldbalanceDest\",\"newbalanceDest\",\"isFraud\"]].corr()\n","corr"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":6,"status":"aborted","timestamp":1771844844719,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"JrF_hSyFQMN-"},"outputs":[],"source":["sns.heatmap(corr,annot=True,cmap = \"coolwarm\", fmt= \".2f\")\n","plt.title(\"Correlation Matrix\")\n","plt.show"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"2k1fuROWRRpb","executionInfo":{"status":"aborted","timestamp":1771844844723,"user_tz":-180,"elapsed":125580,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["zero_after_transfer = df[\n","    (df[\"oldbalanceOrg\"] > 0) &\n","    (df[\"newbalanceOrig\"] == 0) &\n","    (df[\"type\"].isin([\"TRANSFER\", \"CASH_OUT\"]))\n","]"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125578,"status":"aborted","timestamp":1771844844726,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"DwF7f0zeSYnB"},"outputs":[],"source":["custom_palette = sns.color_palette(\"YlOrBr\", 3)\n","\n","# Count of fraud vs legit for zero_after_transfer transactions\n","fig, axes = plt.subplots(1, 1, figsize=(8, 6))\n","\n","sns.countplot(\n","    data=zero_after_transfer,\n","    x=\"isFraud\",\n","    palette=[custom_palette[2], custom_palette[1]],  # Dark brown = Fraud, Lighter brown = Legit\n","    ax=axes\n",")\n","\n","axes.set_title(\"Fraud vs Legit in Zero Balance Transfers\")\n","axes.set_xlabel(\"Is Fraud\")\n","axes.set_ylabel(\"Number of Transactions\")\n","axes.set_axisbelow(True)\n","axes.grid(axis='y', color='gray', linestyle='--', linewidth=0.7)\n","\n","plt.show()"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125573,"status":"aborted","timestamp":1771844844729,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"cDdC9tJxTJGF"},"outputs":[],"source":["# Count number of frauds in the filtered DataFrame\n","fraud_count_filtered = zero_after_transfer['isFraud'].sum()\n","print(\"Number of frauds in filtered rows:\", fraud_count_filtered)\n","\n","# Count both fraud and non-fraud in the filtered DataFrame\n","transaction_summary_filtered = zero_after_transfer['isFraud'].value_counts()\n","print(transaction_summary_filtered)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"gtPiQTUgoRGV","executionInfo":{"status":"aborted","timestamp":1771844844731,"user_tz":-180,"elapsed":125570,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["df[\"zero_flag\"] = (\n","    (df[\"oldbalanceOrg\"] > 0) &\n","    (df[\"newbalanceOrig\"] == 0) &\n","    (df[\"type\"].isin([\"TRANSFER\", \"CASH_OUT\"]))\n",").astype(int)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125568,"status":"aborted","timestamp":1771844844732,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"Bjx8f67jt718"},"outputs":[],"source":["\n","cm = confusion_matrix(df[\"isFraud\"], df[\"zero_flag\"])\n","print(cm)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125562,"status":"aborted","timestamp":1771844844733,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"kwMqbIc7udHK"},"outputs":[],"source":["TN, FP, FN, TP = cm.ravel()\n","\n","print(\"TN:\", TN)\n","print(\"FP:\", FP)\n","print(\"FN:\", FN)\n","print(\"TP:\", TP)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125557,"status":"aborted","timestamp":1771844844734,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"Wjfpc4fEuFXy"},"outputs":[],"source":["\n","table = [\n","    [8012, 1180062],   # Filtered\n","    [201, 5174345]     # Not Filtered\n","]\n","\n","chi2, p, _, _ = chi2_contingency(table)\n","print(\"p-value:\", p)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125553,"status":"aborted","timestamp":1771844844735,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"Xgt5gD_EuJL2"},"outputs":[],"source":["precision = TP / (TP + FP)\n","print(\"Precision:\", precision)\n","recall = TP / (TP + FN)\n","print(\"Recall:\", recall)\n","f1 = 2 * (precision * recall) / (precision + recall)\n","print(\"F1 Score:\", f1)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125546,"status":"aborted","timestamp":1771844844739,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"_QinR1_CwLkJ"},"outputs":[],"source":["zero_flag = 0 or 1\n","y_true = df[\"isFraud\"]\n","y_score = df[\"zero_flag\"]   # using rule as prediction score\n","\n","auc = roc_auc_score(y_true, y_score)\n","print(\"ROC-AUC:\", auc)\n","\n","fpr, tpr, _ = roc_curve(y_true, y_score)\n","\n","plt.plot(fpr, tpr)\n","plt.plot([0,1],[0,1], linestyle=\"--\")\n","plt.xlabel(\"False Positive Rate\")\n","plt.ylabel(\"True Positive Rate\")\n","plt.title(\"ROC Curve - Zero Balance Rule\")\n","plt.show()\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"UwzCaLwCwlHj","executionInfo":{"status":"aborted","timestamp":1771844844742,"user_tz":-180,"elapsed":125545,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["df[\"large_txn\"] = (df[\"amount\"] > 200000).astype(int)\n","df[\"combined_flag\"] = (\n","    (df[\"zero_flag\"] == 1) &\n","    (df[\"large_txn\"] == 1)\n",").astype(int)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"8MStDnZ6xTvs","executionInfo":{"status":"aborted","timestamp":1771844844744,"user_tz":-180,"elapsed":125541,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["df[\"risk_score\"] = (\n","    df[\"zero_flag\"] * 2 +\n","    df[\"large_txn\"] * 1 +\n","    (df[\"type\"] == \"TRANSFER\").astype(int)\n",")\n"]},{"cell_type":"markdown","metadata":{"id":"zh0gRFCexrOS"},"source":[]},{"cell_type":"code","execution_count":null,"metadata":{"id":"EW_WCUL3z506","executionInfo":{"status":"aborted","timestamp":1771844844746,"user_tz":-180,"elapsed":125536,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["df[\"prediction\"] = (df[\"risk_score\"] >= 2).astype(int)\n"]},{"cell_type":"markdown","metadata":{"id":"mR1rGS34UcMk"},"source":["# New section"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125533,"status":"aborted","timestamp":1771844844748,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"mozPZIqP0uUi"},"outputs":[],"source":["# STEP 5 — Initialize Feature Engineering\n","\n","df_fe = df.copy()\n","\n","print(\"Feature engineering dataframe created.\")\n","print(\"Shape:\", df_fe.shape)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"E7ZI1NCj1MzO","executionInfo":{"status":"aborted","timestamp":1771844844749,"user_tz":-180,"elapsed":125527,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["df_fe = df_fe.drop(columns=[\n","    'nameOrig',\n","    'nameDest',\n","    'prediction',\n","    'isFlaggedFraud'\n","], errors='ignore')"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125523,"status":"aborted","timestamp":1771844844750,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"8ffIb53h1nmH"},"outputs":[],"source":["df_fe.columns"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125518,"status":"aborted","timestamp":1771844844751,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"eItnmrYr1rDR"},"outputs":[],"source":["df.head()"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125516,"status":"aborted","timestamp":1771844844758,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"Jk0yw3qT15ES"},"outputs":[],"source":["print(df.shape)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"vjaEbRm12WwP","executionInfo":{"status":"aborted","timestamp":1771844844760,"user_tz":-180,"elapsed":125507,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["# Zero balance indicators\n","\n","df_fe['zero_orig_flag'] = (df_fe['oldbalanceOrg'] == 0).astype('int8')\n","df_fe['zero_dest_flag'] = (df_fe['oldbalanceDest'] == 0).astype('int8')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"VPrtjvdB2r-p","executionInfo":{"status":"aborted","timestamp":1771844844762,"user_tz":-180,"elapsed":125504,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["# Top 1% transaction size\n","\n","threshold = df_fe['amount'].quantile(0.99)\n","\n","df_fe['large_txn_flag'] = (df_fe['amount'] > threshold).astype('int8')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"wv43vVAf2vd0","executionInfo":{"status":"aborted","timestamp":1771844844764,"user_tz":-180,"elapsed":125501,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["df_fe['high_risk_type'] = df_fe['type'].isin(['TRANSFER', 'CASH_OUT']).astype('int8')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"k29gREq92zOw","executionInfo":{"status":"aborted","timestamp":1771844844766,"user_tz":-180,"elapsed":125496,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["df_fe['amount_balance_ratio'] = df_fe['amount'] / (df_fe['oldbalanceOrg'] + 1)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"p8c3Snpx22kh","executionInfo":{"status":"aborted","timestamp":1771844844768,"user_tz":-180,"elapsed":125494,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["df_fe = df_fe.drop(columns=['prediction'], errors='ignore')"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125491,"status":"aborted","timestamp":1771844844769,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"ESGr8hfG269O"},"outputs":[],"source":["# Handle Class Imbalance\n","fraud_count = df_fe['isFraud'].sum()\n","nonfraud_count = len(df_fe) - fraud_count\n","total = len(df_fe)\n","\n","print(f\"Total transactions: {total}\")\n","print(f\"Fraudulent: {fraud_count} ({fraud_count/total:.4%})\")\n","print(f\"Non-Fraudulent: {nonfraud_count} ({nonfraud_count/total:.4%})\")"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125488,"status":"aborted","timestamp":1771844844774,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"qsxsvzMo3t6t"},"outputs":[],"source":["from sklearn.model_selection import train_test_split\n","\n","# Separate features & target\n","X = df_fe.drop('isFraud', axis=1)\n","y = df_fe['isFraud']\n","\n","# Stratified split\n","X_train, X_test, y_train, y_test = train_test_split(\n","    X, y,\n","    test_size=0.2,\n","    stratify=y,       # ensures same class ratio in train & test\n","    random_state=42\n",")\n","\n","print(\"✅ Train/Test split done\")\n","print(f\"Training set: {len(X_train)}, Testing set: {len(X_test)}\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"1xbkKFB636EF","executionInfo":{"status":"aborted","timestamp":1771844844776,"user_tz":-180,"elapsed":125484,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["# One-hot encode 'type'\n","X_train_encoded = pd.get_dummies(X_train, columns=['type'], drop_first=True)\n","X_test_encoded  = pd.get_dummies(X_test, columns=['type'], drop_first=True)\n","\n","# Confirm columns match\n","X_test_encoded = X_test_encoded.reindex(columns=X_train_encoded.columns, fill_value=0)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"IQOhVzzB3-7L","executionInfo":{"status":"aborted","timestamp":1771844844777,"user_tz":-180,"elapsed":125482,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["from sklearn.preprocessing import LabelEncoder\n","\n","le = LabelEncoder()\n","X_train['type'] = le.fit_transform(X_train['type'])\n","X_test['type'] = le.transform(X_test['type'])"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"SJvgsntq4llz","executionInfo":{"status":"aborted","timestamp":1771844844779,"user_tz":-180,"elapsed":125481,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["from sklearn.compose import ColumnTransformer\n","from sklearn.preprocessing import OneHotEncoder\n","\n","categorical_features = ['type']\n","numeric_features = X_train.drop(columns=categorical_features).columns\n","\n","preprocessor = ColumnTransformer(\n","    transformers=[\n","        ('cat', OneHotEncoder(drop='first'), categorical_features)\n","    ],\n","    remainder='passthrough'\n",")\n","\n","X_train_processed = preprocessor.fit_transform(X_train)\n","X_test_processed  = preprocessor.transform(X_test)"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125473,"status":"aborted","timestamp":1771844844780,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"ZELoYVid4nx4"},"outputs":[],"source":["from sklearn.linear_model import LogisticRegression\n","from sklearn.ensemble import RandomForestClassifier\n","# Logistic Regression\n","lr = LogisticRegression(class_weight='balanced', max_iter=1000, random_state=42)\n","lr.fit(X_train_encoded, y_train)\n","\n","# Random Forest\n","rf = RandomForestClassifier(class_weight='balanced', n_estimators=100, random_state=42)\n","rf.fit(X_train_encoded, y_train)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"m2CQSVNs4sKJ","executionInfo":{"status":"aborted","timestamp":1771844844782,"user_tz":-180,"elapsed":125462,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["\n","df_fe = df_fe.drop(columns=['prediction'], errors='ignore')\n","# risk_score is OK if not derived from isFraud"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125458,"status":"aborted","timestamp":1771844844783,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"8WAJIRM745N7"},"outputs":[],"source":["categorical_cols = df_fe.select_dtypes(include=['object']).columns.tolist()\n","print(\"Categorical columns to encode:\", categorical_cols)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"AFsMzNYg5lWR","executionInfo":{"status":"aborted","timestamp":1771844844784,"user_tz":-180,"elapsed":125454,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["df_fe = df_fe.drop(columns=['nameOrig', 'nameDest'], errors='ignore')"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125452,"status":"aborted","timestamp":1771844844785,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"7D5XuZ0G53m2"},"outputs":[],"source":["X = df_fe.drop('isFraud', axis=1)\n","y = df_fe['isFraud']\n","\n","# One-hot encode 'type'\n","X_encoded = pd.get_dummies(X, columns=['type'], drop_first=True)\n","\n","print(\"Columns after encoding:\", X_encoded.columns.tolist())"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125450,"status":"aborted","timestamp":1771844844789,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"JFqrpgbK56b8"},"outputs":[],"source":["from sklearn.model_selection import train_test_split\n","\n","X_train, X_test, y_train, y_test = train_test_split(\n","    X_encoded, y,\n","    test_size=0.2,\n","    stratify=y,\n","    random_state=42\n",")\n","\n","print(\"Train shape:\", X_train.shape)\n","print(\"Test shape:\", X_test.shape)"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125449,"status":"aborted","timestamp":1771844844792,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"YRoeuafV6J2H"},"outputs":[],"source":["print(\"Fraud in train set:\", y_train.sum())\n","print(\"Non-fraud in train set:\", len(y_train) - y_train.sum())"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"lQ2mJYq56OJ6","executionInfo":{"status":"aborted","timestamp":1771844844793,"user_tz":-180,"elapsed":125438,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["# Target variable\n","y = df_fe['isFraud'].copy()\n","\n","# Features — drop target and any leakage columns\n","X = df_fe.drop(columns=['isFraud'], errors='ignore').copy()"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125434,"status":"aborted","timestamp":1771844844795,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"BVI_7-Ub6tqm"},"outputs":[],"source":["# Check for non-numeric columns\n","non_numeric_cols = X.select_dtypes(include=['object']).columns.tolist()\n","print(\"Non-numeric columns remaining:\", non_numeric_cols)"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125428,"status":"aborted","timestamp":1771844844796,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"HoXoWhTL6yYY"},"outputs":[],"source":["print(\"First 5 feature columns:\")\n","print(X.columns[:5].tolist())\n","\n","print(\"Total features:\", X.shape[1])"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125425,"status":"aborted","timestamp":1771844844798,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"hLl5C_li7Ay5"},"outputs":[],"source":["print(f\"Features (X) shape: {X.shape}\")\n","print(f\"Target (y) shape: {y.shape}\")\n","print(f\"Total transactions: {len(X)}\")\n","print(f\"Fraudulent transactions: {y.sum()} ({y.sum()/len(y):.4%})\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"2dul927c7HVX","executionInfo":{"status":"aborted","timestamp":1771844844843,"user_tz":-180,"elapsed":125464,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["# Stratified split ensures same fraud ratio in train & test\n","X_train, X_test, y_train, y_test = train_test_split(\n","    X,                # features\n","    y,                # target\n","    test_size=0.2,    # 20% test\n","    stratify=y,       # preserves fraud/non-fraud ratio\n","    random_state=42   # reproducible results\n",")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125463,"status":"aborted","timestamp":1771844844849,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"fOK9WnDb_97E"},"outputs":[],"source":["print(\"✅ Train/Test split complete\")\n","print(f\"Training set: {X_train.shape[0]} rows, {X_train.shape[1]} features\")\n","print(f\"Testing set:  {X_test.shape[0]} rows, {X_test.shape[1]} features\")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125456,"status":"aborted","timestamp":1771844844851,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"ClzaHEy3AFil"},"outputs":[],"source":["print(\"Fraud in training set:\", y_train.sum(), f\"({y_train.sum()/len(y_train):.4%})\")\n","print(\"Fraud in testing set: \", y_test.sum(), f\"({y_test.sum()/len(y_test):.4%})\")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"uM1cXOxZAPh8","executionInfo":{"status":"aborted","timestamp":1771844844856,"user_tz":-180,"elapsed":125451,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["# Make sure feature columns align\n","assert list(X_train.columns) == list(X_test.columns), \"Feature columns mismatch!\"\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"YZ9faWHrAYzk","executionInfo":{"status":"aborted","timestamp":1771844844860,"user_tz":-180,"elapsed":125449,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["# step Train Baseline Model\n","# Use class_weight='balanced' to handle the extreme fraud imbalance\n","lr = LogisticRegression(\n","    class_weight='balanced',  # gives more weight to fraud cases\n","    max_iter=1000,             # ensures convergence\n","    random_state=42\n",")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125450,"status":"aborted","timestamp":1771844844864,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"0Riiy_ReDYvf"},"outputs":[],"source":["# Drop ID columns if any remain\n","df_fe = df_fe.drop(columns=['nameOrig', 'nameDest'], errors='ignore')\n","\n","# One-hot encode 'type' column (categorical)\n","df_fe = pd.get_dummies(df_fe, columns=['type'], drop_first=True)\n","\n","# Separate features and target\n","X = df_fe.drop(columns=['isFraud'], errors='ignore')\n","y = df_fe['isFraud']\n","\n","# Confirm all features are numeric\n","print(\"Non-numeric columns in X:\", X.select_dtypes(include=['object']).columns.tolist())\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":125445,"status":"aborted","timestamp":1771844844866,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"},"user_tz":-180},"id":"WDGKhBCcDfQh"},"outputs":[],"source":["from sklearn.model_selection import train_test_split\n","\n","X_train, X_test, y_train, y_test = train_test_split(\n","    X, y,\n","    test_size=0.2,\n","    stratify=y,       # preserves fraud ratio\n","    random_state=42\n",")\n","\n","print(\"Train shape:\", X_train.shape)\n","print(\"Test shape:\", X_test.shape)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Rdg_67JFFCYK","executionInfo":{"status":"aborted","timestamp":1771844844869,"user_tz":-180,"elapsed":125444,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["# Class-weight handles extreme imbalance\n","lr = LogisticRegression(\n","    class_weight='balanced',\n","    max_iter=1000,\n","    random_state=42\n",")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"mHjNf0EWFFZ4","executionInfo":{"status":"aborted","timestamp":1771844844875,"user_tz":-180,"elapsed":125445,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"outputs":[],"source":["lr.fit(X_train, y_train)\n","print(\"✅ Logistic Regression baseline trained successfully\")"]},{"cell_type":"code","source":["y_pred = lr.predict(X_test)\n","y_proba = lr.predict_proba(X_test)[:, 1]  # probability of fraud"],"metadata":{"id":"NutfVVp_WteQ","executionInfo":{"status":"aborted","timestamp":1771844844879,"user_tz":-180,"elapsed":125437,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from sklearn.metrics import classification_report, confusion_matrix, roc_auc_score, roc_curve\n","import matplotlib.pyplot as plt\n","\n","cm = confusion_matrix(y_test, y_pred)\n","print(\"Confusion Matrix:\\n\", cm)"],"metadata":{"id":"skosA5TzYyes","executionInfo":{"status":"aborted","timestamp":1771844844882,"user_tz":-180,"elapsed":125435,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["print(\"Classification Report:\\n\", classification_report(y_test, y_pred, digits=4))"],"metadata":{"id":"twvv7bXnY3Xb","executionInfo":{"status":"aborted","timestamp":1771844844884,"user_tz":-180,"elapsed":125430,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["auc_score = roc_auc_score(y_test, y_proba)\n","print(f\"ROC-AUC Score: {auc_score:.4f}\")"],"metadata":{"id":"_22msVonY51p","executionInfo":{"status":"aborted","timestamp":1771844844888,"user_tz":-180,"elapsed":125428,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["fpr, tpr, thresholds = roc_curve(y_test, y_proba)\n","plt.figure(figsize=(6,5))\n","plt.plot(fpr, tpr, label=f'ROC Curve (AUC = {auc_score:.4f})')\n","plt.plot([0,1], [0,1], linestyle='--', color='gray')\n","plt.xlabel('False Positive Rate')\n","plt.ylabel('True Positive Rate')\n","plt.title('ROC Curve - Logistic Regression')\n","plt.legend()\n","plt.show()"],"metadata":{"id":"vsiGTnFSZJ0J","executionInfo":{"status":"aborted","timestamp":1771844844892,"user_tz":-180,"elapsed":125417,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["cm = confusion_matrix(y_test, y_pred)\n","tn, fp, fn, tp = cm.ravel()\n","\n","print(\"Confusion Matrix:\")\n","print(cm)\n","\n","# Optional: Pretty heatmap\n","plt.figure(figsize=(5,4))\n","sns.heatmap(cm, annot=True, fmt=\"d\", cmap=\"Blues\", xticklabels=['Pred 0','Pred 1'], yticklabels=['Actual 0','Actual 1'])\n","plt.xlabel(\"Predicted\")\n","plt.ylabel(\"Actual\")\n","plt.title(\"Confusion Matrix\")\n","plt.show()\n","\n","print(f\"\\nTN: {tn}, FP: {fp}, FN: {fn}, TP: {tp}\")"],"metadata":{"id":"n6jd65MBZaw2","executionInfo":{"status":"aborted","timestamp":1771844844896,"user_tz":-180,"elapsed":125410,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["print(\"Classification Report:\\n\")\n","report = classification_report(y_test, y_pred, digits=4)\n","print(report)"],"metadata":{"id":"7cvw2-A2a0Fn","executionInfo":{"status":"aborted","timestamp":1771844844898,"user_tz":-180,"elapsed":125406,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["auc_score = roc_auc_score(y_test, y_proba)\n","print(f\"ROC-AUC Score: {auc_score:.4f}\")"],"metadata":{"id":"2sHueUxkbCOK","executionInfo":{"status":"aborted","timestamp":1771844844901,"user_tz":-180,"elapsed":125403,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["fpr, tpr, thresholds = roc_curve(y_test, y_proba)\n","plt.figure(figsize=(6,5))\n","plt.plot(fpr, tpr, label=f'ROC Curve (AUC = {auc_score:.4f})', linewidth=2)\n","plt.plot([0,1], [0,1], linestyle='--', color='gray')\n","plt.xlabel('False Positive Rate')\n","plt.ylabel('True Positive Rate')\n","plt.title('ROC Curve')\n","plt.legend()\n","plt.show()"],"metadata":{"id":"wHJErrMwbWe9","executionInfo":{"status":"aborted","timestamp":1771844844907,"user_tz":-180,"elapsed":125399,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier\n","from sklearn.metrics import classification_report, confusion_matrix, roc_auc_score, roc_curve\n","import matplotlib.pyplot as plt\n","import seaborn as sns"],"metadata":{"id":"HGHbwPv9beiY","executionInfo":{"status":"aborted","timestamp":1771844844911,"user_tz":-180,"elapsed":125396,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# Initialize Random Forest\n","rf = RandomForestClassifier(\n","    n_estimators=100,\n","    class_weight='balanced',\n","    max_depth=None,\n","    random_state=42,\n","    n_jobs=-1\n",")\n","\n","# Train\n","rf.fit(X_train, y_train)\n","print(\" Random Forest trained successfully\")"],"metadata":{"id":"jCq2fojFc98K","executionInfo":{"status":"aborted","timestamp":1771844844914,"user_tz":-180,"elapsed":125393,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# Predictions\n","y_pred_rf = rf.predict(X_test)\n","y_proba_rf = rf.predict_proba(X_test)[:, 1]\n","\n","# Confusion matrix\n","cm_rf = confusion_matrix(y_test, y_pred_rf)\n","sns.heatmap(cm_rf, annot=True, fmt=\"d\", cmap=\"Blues\", xticklabels=['Pred 0','Pred 1'], yticklabels=['Actual 0','Actual 1'])\n","plt.title(\"Random Forest Confusion Matrix\")\n","plt.show()\n","\n","# Classification report\n","print(\"Random Forest Classification Report:\\n\")\n","print(classification_report(y_test, y_pred_rf, digits=4))\n","\n","# ROC-AUC\n","auc_rf = roc_auc_score(y_test, y_proba_rf)\n","print(f\"Random Forest ROC-AUC: {auc_rf:.4f}\")"],"metadata":{"id":"qEhlz6T0dEmD","executionInfo":{"status":"aborted","timestamp":1771844844916,"user_tz":-180,"elapsed":125380,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# Gradient Boosting\n","gb = GradientBoostingClassifier(\n","    n_estimators=100,\n","    learning_rate=0.1,\n","    max_depth=3,\n","    random_state=42\n",")\n","\n","gb.fit(X_train, y_train)\n","print(\"✅ Gradient Boosting trained successfully\")\n","\n","# Predictions\n","y_pred_gb = gb.predict(X_test)\n","y_proba_gb = gb.predict_proba(X_test)[:, 1]\n","\n","# Evaluate\n","print(\"Gradient Boosting Classification Report:\\n\")\n","print(classification_report(y_test, y_pred_gb, digits=4))\n","\n","auc_gb = roc_auc_score(y_test, y_proba_gb)\n","print(f\"Gradient Boosting ROC-AUC: {auc_gb:.4f}\")"],"metadata":{"id":"W9M6MlNSdUMc","executionInfo":{"status":"aborted","timestamp":1771844844924,"user_tz":-180,"elapsed":125379,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["plt.figure(figsize=(6,5))\n","fpr_rf, tpr_rf, _ = roc_curve(y_test, y_proba_rf)\n","fpr_gb, tpr_gb, _ = roc_curve(y_test, y_proba_gb)\n","\n","plt.plot(fpr_rf, tpr_rf, label=f'Random Forest (AUC={auc_rf:.4f})')\n","plt.plot(fpr_gb, tpr_gb, label=f'Gradient Boosting (AUC={auc_gb:.4f})')\n","plt.plot([0,1],[0,1], linestyle='--', color='gray')\n","plt.xlabel(\"False Positive Rate\")\n","plt.ylabel(\"True Positive Rate\")\n","plt.title(\"ROC Curve Comparison\")\n","plt.legend()\n","plt.show()"],"metadata":{"id":"uYCn2mB2df0v","executionInfo":{"status":"aborted","timestamp":1771844844927,"user_tz":-180,"elapsed":125368,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# Random Forest feature importance\n","feat_imp_rf = pd.Series(rf.feature_importances_, index=X_train.columns).sort_values(ascending=False)\n","print(\"Top 10 RF features:\\n\", feat_imp_rf.head(10))\n","\n","# Gradient Boosting feature importance\n","feat_imp_gb = pd.Series(gb.feature_importances_, index=X_train.columns).sort_values(ascending=False)\n","print(\"Top 10 GB features:\\n\", feat_imp_gb.head(10))"],"metadata":{"id":"eHqGhVbMeNA4","executionInfo":{"status":"aborted","timestamp":1771844844931,"user_tz":-180,"elapsed":125367,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# Example: Lower threshold to 0.3\n","y_pred_rf_thresh = (y_proba_rf >= 0.3).astype(int)\n","print(classification_report(y_test, y_pred_rf_thresh, digits=4))"],"metadata":{"id":"k2hb9_RzejP_","executionInfo":{"status":"aborted","timestamp":1771844844934,"user_tz":-180,"elapsed":125361,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from sklearn.metrics import precision_recall_curve, auc\n","\n","precision, recall, thresholds = precision_recall_curve(y_test, y_proba_rf)\n","pr_auc = auc(recall, precision)\n","plt.figure(figsize=(6,5))\n","plt.plot(recall, precision, label=f'PR Curve (AUC={pr_auc:.4f})')\n","plt.xlabel('Recall')\n","plt.ylabel('Precision')\n","plt.title('Precision-Recall Curve - Random Forest')\n","plt.legend()\n","plt.show()"],"metadata":{"id":"5Byyro9OfF1d","executionInfo":{"status":"aborted","timestamp":1771844844938,"user_tz":-180,"elapsed":125357,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from sklearn.model_selection import cross_val_score\n","\n","scores = cross_val_score(rf, X, y, cv=5, scoring='roc_auc')\n","print(\"5-fold CV ROC-AUC:\", scores, \"Mean:\", scores.mean())"],"metadata":{"id":"CUvIEpqafOYD","executionInfo":{"status":"aborted","timestamp":1771844844965,"user_tz":-180,"elapsed":125375,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["rf.fit(X_train, y_train)"],"metadata":{"id":"_rGIWAVPwGuB","executionInfo":{"status":"aborted","timestamp":1771844844980,"user_tz":-180,"elapsed":125382,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from google.colab import drive\n","drive.mount('/content/drive')"],"metadata":{"id":"29gbMv325_AG","executionInfo":{"status":"aborted","timestamp":1771844844983,"user_tz":-180,"elapsed":125377,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["import os\n","\n","project_path = \"/content/drive/MyDrive/fraud_project\"\n","\n","if not os.path.exists(project_path):\n","    os.makedirs(project_path)\n","\n","print(\"✅ Folder ready\")"],"metadata":{"id":"XatIkEea6BaD","executionInfo":{"status":"aborted","timestamp":1771844844985,"user_tz":-180,"elapsed":125374,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["joblib.dump(rf, \"rf_model.pkl\")\n","print(\"✅ Model saved\")"],"metadata":{"id":"QGzhpLQ3wHQw","executionInfo":{"status":"aborted","timestamp":1771844844991,"user_tz":-180,"elapsed":125376,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["import json\n","feature_cols = X_train.columns.tolist()\n","\n","with open(\"feature_columns.json\", \"w\") as f:\n","    json.dump(feature_cols, f)\n","\n","print(\"✅ Feature template saved\")"],"metadata":{"id":"H70_W-p-wPAm","executionInfo":{"status":"aborted","timestamp":1771844844995,"user_tz":-180,"elapsed":125372,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["joblib.dump(X_test, \"X_test.pkl\")\n","joblib.dump(y_test, \"y_test.pkl\")"],"metadata":{"id":"ZzY6_eC7wS0a","executionInfo":{"status":"aborted","timestamp":1771844844998,"user_tz":-180,"elapsed":125369,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["import joblib\n","import json\n","\n","# Save model\n","joblib.dump(rf, f\"{project_path}/rf_model.pkl\")\n","\n","# Save test split (VERY IMPORTANT)\n","joblib.dump(X_test, f\"{project_path}/X_test.pkl\")\n","joblib.dump(y_test, f\"{project_path}/y_test.pkl\")\n","\n","# Save feature template\n","with open(f\"{project_path}/feature_columns.json\", \"w\") as f:\n","    json.dump(X_train.columns.tolist(), f)\n","\n","print(\"✅ Model and artifacts saved to Drive successfully\")"],"metadata":{"id":"810T0tSE6Mw2","executionInfo":{"status":"aborted","timestamp":1771844845001,"user_tz":-180,"elapsed":125363,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":[],"metadata":{"id":"RuyJ5Akd2XoS","executionInfo":{"status":"aborted","timestamp":1771844845005,"user_tz":-180,"elapsed":125362,"user":{"displayName":"Brighton Jeremy","userId":"08890773250908098580"}}},"execution_count":null,"outputs":[]}],"metadata":{"colab":{"provenance":[{"file_id":"124Q2dABQk1TpDQoe6M3xFsV5YSp8fFFt","timestamp":1771714934582},{"file_id":"1AI25cP1KEjWpJJAlucXxkphSy1iVj4RZ","timestamp":1771654558043},{"file_id":"1_CnlyGHNCbUgxI24GgvZTGRK8KFZjYkz","timestamp":1771599502928},{"file_id":"1lWPdWjW1v3sULwGgkUYUVSZ9pEuvnM-u","timestamp":1771537115013},{"file_id":"1IPWNn0xMUVEkyEHq5C7jcuqH_DOCSoZI","timestamp":1771495252786}],"authorship_tag":"ABX9TyPBCemMhhZEwV59VAPqH2Ax"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}